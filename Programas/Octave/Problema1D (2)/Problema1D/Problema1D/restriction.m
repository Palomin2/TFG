function R = restriction(n,p,nc)

R = sparse(nc,n);
if p==2
    if n == 4
        R = [4 2 0 0;0 2 2 0;0 0 2 4];
    elseif n == 6
        R = [4 2 0 0 0 0;0 2 3 1 0 0;0 0 1 3 2 0;0 0 0 0 2 4];
    else
        R(1,:) = [4,2,zeros(n-2,1)'];
        R(2,:) = [0 2 3 1,zeros(n-4,1)'];
        n1 = 3;
        for j = 3:nc-2
            R(j,[n1:n1+3]) = [1 3 3 1];
            n1 = n1+2;
        end
        R(nc-1,:) = [zeros(n-4,1)' 1 3 2 0];
        R(nc,:) = [zeros(n-2,1)' 2 4];           
    end
    R = 1/4*R;
elseif p==3
    if n==5
        R = 1/2*[2 1 0 0 0;0 1 1 0 0;0 0 1 1 0;0 0 0 1 2];
    elseif n ==7
        R = 1/16*[16 8 0 0 0 0 0;0 8 12 3 0 0 0;0 0 4 10 4 0 0; ...
                   0 0 0 3 12 8 0;0 0 0 0 0 8 16];
    else
        R(1,:) = 1/16*[16,8,zeros(n-2,1)'];
        R(2,:) = 1/16*[0,8,12,3,zeros(n-4,1)'];
        R(3,:) = 1/16*[0 0 4 11 8 2, zeros(n-6,1)'];
        n1 = 4;
        for j = 4:nc-3
            R(j,[n1:n1+4]) = 1/16*[2 8 12 8 2];
            n1 = n1 + 2;
        end
        R(nc-2,:) = 1/16*[zeros(n-6,1)',2,8,11,4,0,0];
        R(nc-1,:) = 1/16*[zeros(n-4,1)',3,12,8,0];
        R(nc,:) = 1/16*[zeros(n-2,1)',8,16];
    end  
elseif p==4
    if n==6
        R=1/2*[2 1 0 0 0 0;0 1 1 0 0 0;0 0 1 1 0 0; ...
               0 0 0 1 1 0;0 0 0 0 1 2];
    elseif n==8
        R=1/48*[48 24 0 0 0 0 0 0;0 24 36 9 0 0 0 0;...
                0 0 12 30 9 0 0 0;0 0 0 9 30 12 0 0;...
                0 0 0 0 9 36 24 0;0 0 0 0 0 0 24 48];
    else
        R(1,:) = [48,24,zeros(n-2,1)'];
        R(2,:) = [0 24 36 9, zeros(n-4,1)'];
        R(3,:) = [0 0 12 33 20 4 zeros(n-6,1)'];
        R(4,:) = [0 0 0 6 25 29 15 3 zeros(n-8,1)'];
        n1 = 5;
        for j = 5:nc-4
            R(j,[n1:n1+5]) = [3 15 30 30 15 3];
            n1 = n1 + 2;
        end
        R(nc-3,:) = [zeros(n-8,1)',3,15,29,25,6,0,0,0];
        R(nc-2,:) = [zeros(n-6,1)',4,20,33,12,0,0];
        R(nc-1,:) = [zeros(n-4,1)',9,36,24,0];
        R(nc,:) = [zeros(n-2,1)',24,48];
        R = 1/48*R;
    end
elseif p==5
    if n==7
        R=1/2*[2 1 0 0 0 0 0; ...
               0 1 1 0 0 0 0; ... 
               0 0 1 1 0 0 0; ...
               0 0 0 1 1 0 0; ...
               0 0 0 0 1 1 0; ...
               0 0 0 0 0 1 2];
    elseif n==9
        R=1/48*[48 24  0  0  0  0  0  0  0; ...
                 0 24 36  9  0  0  0  0  0; ...
                 0  0 12 30  9  0  0  0  0; ...
                 0  0  0  9 30  9  0  0  0; ...
                 0  0  0  0  9 30 12  0  0; ...
                 0  0  0  0  0  9 36 24  0; ...
                 0  0  0  0  0  0  0 24 48];
    elseif n==13
        R=1/1152*[1152 576   0   0   0   0   0   0   0   0   0   0    0; ...
                     0 576 864 216   0   0   0   0   0   0   0   0    0; ...
                     0   0 288 792 480  80   0   0   0   0   0   0    0; ...
                     0   0   0 144 600 625 270  45   0   0   0   0    0; ...
                     0   0   0   0  72 402 612 402  72   0   0   0    0; ...
                     0   0   0   0   0  45 270 625 600 144   0   0    0; ...
                     0   0   0   0   0   0   0  80 480 792 288   0    0; ...
                     0   0   0   0   0   0   0   0   0 216 864 576    0; ...
                     0   0   0   0   0   0   0   0   0   0   0 576 1152];
    else
        R(1,:) = [1152,576,zeros(n-2,1)'];
        R(2,:) = [0 576 864 216, zeros(n-4,1)'];
        R(3,:) = [0 0 288 792 480 80 zeros(n-6,1)'];
        R(4,:) = [0 0 0 144 600 625 270 45 zeros(n-8,1)'];
        R(5,:) = [0 0 0 0 72 411 666 531 216 36 zeros(n-10,1)'];
        n1 = 6;
        for j = 6:nc-5
            R(j,[n1:n1+6]) = [36 216 540 720 540 216 36];
            n1 = n1 + 2;
        end
        R(nc-4,:) = [zeros(n-10,1)',36,216,531,666,411,72,0,0,0 0];
        R(nc-3,:) = [zeros(n-8,1)', 45,270,625,600,144,0,0,0];
        R(nc-2,:) = [zeros(n-6,1)', 80,480,792,288,0,0];
        R(nc-1,:) = [zeros(n-4,1)',216,864,576,0];
        R(nc,:) = [zeros(n-2,1)',576,1152];
        R = 1/1152*R;
    end
elseif p==6
    if n==8
        R=1/2*[2 1 0 0 0 0 0 0; ...
               0 1 1 0 0 0 0 0; ... 
               0 0 1 1 0 0 0 0; ...
               0 0 0 1 1 0 0 0; ...
               0 0 0 0 1 1 0 0; ...
               0 0 0 0 0 1 1 0; ...
               0 0 0 0 0 0 1 2];
    elseif n==10
        R=1/16*[16 8  0  0  0  0  0  0  0  0; ...
                 0 8 12  3  0  0  0  0  0  0; ...
                 0 0  4 10  3  0  0  0  0  0; ...
                 0 0  0  3 10  3  0  0  0  0; ...
                 0 0  0  0  3 10  3  0  0  0; ...
                 0 0  0  0  0  3 10  4  0  0; ...
                 0 0  0  0  0  0  3 12  8  0; ...
                 0 0  0  0  0  0  0  0  8 16];
    elseif n==14
        R=[1 1/2   0     0     0        0       0       0        0     0     0   0    0  0; ...
           0 1/2 3/4  3/16     0        0       0       0        0     0     0   0    0  0; ...
           0   0 1/4 11/16  5/12     5/72       0       0        0     0     0   0    0  0; ...
           0   0   0   1/8 25/48 625/1152 105/512  15/512        0     0     0   0    0  0; ...
           0   0   0   0    1/16   67/192 253/512 139/512    5/128     0     0   0    0  0; ...
           0   0   0   0       0    5/128 139/512 253/512   67/192  1/16     0   0    0  0; ...
           0   0   0   0       0        0  15/152 105/512 625/1152 25/48   1/8   0    0  0; ...
           0   0   0   0       0        0       0       0     5/72  5/12 11/16 1/4    0  0; ...
           0   0   0   0       0        0       0       0        0     0  3/16 3/4  1/2  0; ...
           0   0   0   0       0        0       0       0        0     0     0   0  1/2  1];
    else
        R(1,:) = [1 1/2 zeros(n-2,1)'];
        R(2,:) = [0 1/2 3/4  3/16 zeros(n-4,1)'];
        R(3,:) = [0   0 1/4 11/16  5/12 5/72 zeros(n-6,1)'];
        R(4,:) = [0   0   0   1/8 25/48 625/1152 105/512   15/512 zeros(n-8,1)'];
        R(5,:) = [0   0   0     0  1/16  137/384 493/897 969/2560 21/160 3/160 zeros(n-10,1)'];
        R(6,:) = [0   0   0     0     0     1/32 147/640  309/640  21/40 13/40 7/64 1/64 zeros(n-12,1)'];
        n1 = 7;
        for j = 7:nc-6
            R(j,[n1:n1+7]) = [1/64 7/64 21/64 35/64 35/64 21/64 7/64 1/64];
            n1 = n1 + 2;
        end
        R(nc-5,:) = [zeros(n-12,1)',1/64,7/64,13/40,21/40,309/640,147/640,1/32,0,0,0,0,0];
        R(nc-4,:) = [zeros(n-10,1)',3/160,21/160,969/2560,493/897,137/384,1/16,0,0,0,0];
        R(nc-3,:) = [zeros(n-8,1)', 15/512,105/512,625/1152,25/48,1/8,0,0,0];
        R(nc-2,:) = [zeros(n-6,1)', 5/72,5/12,11/16,1/4,0,0];
        R(nc-1,:) = [zeros(n-4,1)',3/16,3/4,1/2,0];
        R(nc,:) = [zeros(n-2,1)',1/2,1];
%         R = R;
    end
elseif p==7
    if n==9
        R=1/2*[2 1 0 0 0 0 0 0 0; ...
               0 1 1 0 0 0 0 0 0; ... 
               0 0 1 1 0 0 0 0 0; ...
               0 0 0 1 1 0 0 0 0; ...
               0 0 0 0 1 1 0 0 0; ...
               0 0 0 0 0 1 1 0 0; ...
               0 0 0 0 0 0 1 1 0; ...
               0 0 0 0 0 0 0 1 2];
    elseif n==11
        R=1/16*[16 8  0  0  0  0  0  0  0  0 0; ...
                 0 8 12  3  0  0  0  0  0  0 0; ...
                 0 0  4 10  3  0  0  0  0  0 0; ...
                 0 0  0  3 10  3  0  0  0  0 0; ...
                 0 0  0  0  3 10  3  0  0  0 0; ...
                 0 0  0  0  0  3 10  3  0  0 0; ...
                 0 0  0  0  0  0  3 10  4  0 0; ...
                 0 0  0  0  0  0  0  3 12  8 0; ...
                 0 0  0  0  0  0  0  0  0  8 16];
    elseif n==15
        R=[1 1/2   0     0     0        0       0         0        0      0       0     0   0    0  0; ...
           0 1/2 3/4  3/16     0        0       0         0        0      0       0     0   0    0  0; ...
           0   0 1/4 11/16  5/12     5/72       0         0        0      0       0     0   0    0  0; ...
           0   0   0   1/8 25/48 625/1152 105/512  105/4096        0      0       0     0   0    0  0; ...
           0   0   0     0  1/16   67/192 253/512  247/1024   15/512      0       0     0   0    0  0; ...
           0   0   0     0     0    5/128 139/512  955/2048  139/512  5/128       0     0   0    0  0; ...
           0   0   0     0     0       0   15/152  247/1024  253/512 67/192    1/16     0   0    0  0; ...
           0   0   0     0     0       0        0  105/4096  105/512 625/1152 25/48   1/8   0    0  0; ...
           0   0   0     0     0       0        0         0        0   5/72    5/12 11/16 1/4    0  0; ...
           0   0   0     0     0       0        0         0        0      0       0  3/16 3/4  1/2  0; ...
           0   0   0     0     0       0        0         0        0      0       0     0   0  1/2  1];
    else
        R(1,:) = [1 1/2 zeros(n-2,1)'];
        R(2,:) = [0 1/2 3/4  3/16 zeros(n-4,1)'];
        R(3,:) = [0   0 1/4 11/16  5/12 5/72 zeros(n-6,1)'];
        R(4,:) = [0   0   0   1/8 25/48 625/1152 105/512 105/4096 zeros(n-8,1)'];
        R(5,:) = [0   0   0     0  1/16  137/384 493/897 355/1031 21/200 21/1600 zeros(n-10,1)'];
        R(6,:) = [0   0   0     0     0     1/32 147/640 626/1303 371/800 399/1600 7/96 7/768 zeros(n-12,1)'];
        R(7,:) = [0   0   0     0     0        0    1/64 363/2560 59/160  327/640 41/96 167/768 1/16 1/128 zeros(n-14,1)'];
        n1 = 8;
        for j = 8:nc-7
            R(j,[n1:n1+8]) = [1/128 1/16 7/32 7/16 35/64 7/16 7/32 1/16 1/128];
            n1 = n1 + 2;
        end
        R(nc-6,:) = [zeros(n-14,1)',1/128,1/16,167/768,41/96,327/640,59/160,363/2560,1/64,0,0,0,0,0,0];
        R(nc-5,:) = [zeros(n-12,1)', 7/768,7/96,399/1600,371/800,626/1303,147/640,1/32,0,0,0,0,0];
        R(nc-4,:) = [zeros(n-10,1)',21/1600,21/200,355/1031,493/897,137/384,1/16,0,0,0,0];
        R(nc-3,:) = [zeros(n-8,1)', 105/4096,105/512,625/1152,25/48,1/8,0,0,0];
        R(nc-2,:) = [zeros(n-6,1)', 5/72,5/12,11/16,1/4,0,0];
        R(nc-1,:) = [zeros(n-4,1)',3/16,3/4,1/2,0];
        R(nc,:) = [zeros(n-2,1)',1/2,1];
%         R = R;
    end
elseif p==8
    if n==10
        R=1/2*[2 1 0 0 0 0 0 0 0 0; ...
               0 1 1 0 0 0 0 0 0 0; ... 
               0 0 1 1 0 0 0 0 0 0; ...
               0 0 0 1 1 0 0 0 0 0; ...
               0 0 0 0 1 1 0 0 0 0; ...
               0 0 0 0 0 1 1 0 0 0; ...
               0 0 0 0 0 0 1 1 0 0; ...
               0 0 0 0 0 0 0 1 1 0; ...
               0 0 0 0 0 0 0 0 1 2];
    elseif n==12
        R=1/16*[16 8  0  0  0  0  0  0  0  0 0  0; ...
                 0 8 12  3  0  0  0  0  0  0 0  0; ...
                 0 0  4 10  3  0  0  0  0  0 0  0; ...
                 0 0  0  3 10  3  0  0  0  0 0  0; ...
                 0 0  0  0  3 10  3  0  0  0 0  0; ...
                 0 0  0  0  0  3 10  3  0  0 0  0; ...
                 0 0  0  0  0  0  3 10  3  0 0  0; ...
                 0 0  0  0  0  0  0  3 10  4 0  0; ...
                 0 0  0  0  0  0  0  0  3 12 8  0;
                 0 0  0  0  0  0  0  0  0  0 8 16];
    elseif n==16
        R=[1 1/2   0     0     0        0       0         0        0        0        0       0     0    0   0  0; ...
           0 1/2 3/4  3/16     0        0       0         0        0        0        0       0     0    0   0  0; ...
           0   0 1/4 11/16  5/12     5/72       0         0        0        0        0       0     0    0   0  0; ...
           0   0   0   1/8 25/48 625/1152 105/512  105/4096        0        0        0       0     0    0   0  0; ...
           0   0   0     0  1/16   67/192 253/512  247/1024  105/4096       0        0       0     0    0   0  0; ...
           0   0   0     0     0    5/128 139/512  955/2048  247/1024  15/512        0       0     0    0   0  0; ...
           0   0   0     0     0       0   15/152  247/1024  955/2048 139/512    5/128       0     0    0   0  0; ...
           0   0   0     0     0       0        0  105/4096  247/1024 253/512   67/192    1/16     0    0   0  0; ...
           0   0   0     0     0       0        0         0  105/4096 105/512 625/1152   25/48   1/8    0   0  0; ...
           0   0   0     0     0       0        0         0        0        0     5/72    5/12 11/16  1/4   0  0; ...
           0   0   0     0     0       0        0         0        0        0       0        0  3/16  3/4 1/2  0; ...
           0   0   0     0     0       0        0         0        0        0       0        0     0    0 1/2  1];
    elseif n==24
        R=[1 1/2   0     0     0        0        0        0         0         0        0         0        0         0         0         0        0        0        0     0     0    0   0  0; ...
           0 1/2 3/4  3/16     0        0        0        0         0         0        0         0        0         0         0         0        0        0        0     0     0    0   0  0; ...
           0   0 1/4 11/16  5/12     5/72        0        0         0         0        0         0        0         0         0         0        0        0        0     0     0    0   0  0; ...
           0   0   0   1/8 25/48 625/1152  105/512 105/4096         0         0        0         0        0         0         0         0        0        0        0     0     0    0   0  0; ...
           0   0   0     0  1/16  137/384  493/897 355/1031  189/2000   21/2000        0         0        0         0         0         0        0        0        0     0     0    0   0  0; ...
           0   0   0     0     0     1/32  147/640 626/1303  876/2011 1621/7703    7/128    7/1152        0         0         0         0        0        0        0     0     0    0   0  0; ...
           0   0   0     0     0        0     1/64 363/2560 1219/3199 2656/5539  317/896 1277/8064     9/224    1/224         0         0        0        0        0     0     0    0   0  0; ...
           0   0   0     0     0        0        0    1/128  146/1719 1134/4289 801/1792   213/451  579/1792 251/1792     9/256     1/256        0        0        0     0     0    0   0  0; ...
           0   0   0     0     0        0        0        0     1/256     9/256 251/1792  579/1792   213/451 801/1792 1134/4289  146/1719    1/128        0        0     0     0    0   0  0; ...
           0   0   0     0     0        0        0        0         0        0     1/224     9/224 1277/8064  317/896 2656/5539 1219/3199 363/2560     1/64        0     0     0    0   0  0; ...
           0   0   0     0     0        0        0        0         0        0         0         0    7/1152    7/128 1746/8297  876/2011 626/1303  147/640     1/32     0     0    0   0  0; ...
           0   0   0     0     0        0        0        0         0        0         0         0        0        0    21/2000  189/2000 355/1031  493/897  137/384  1/16     0    0   0  0; ...
           0   0   0     0     0        0        0        0         0        0         0         0        0        0        0          0  105/4096  105/512 625/1152 25/48   1/8    0   0  0; ...
           0   0   0     0     0        0        0        0         0        0         0         0        0        0        0          0        0         0     5/72  5/12 11/16  1/4   0  0; ...
           0   0   0     0     0        0        0        0         0        0         0         0        0        0        0          0        0         0        0     0  3/16  3/4 1/2  0; ...
           0   0   0     0     0        0        0        0         0        0         0         0        0        0        0          0        0         0        0     0     0    0 1/2  1];
    else   
        R(1,:) = [1 1/2 zeros(n-2,1)'];
        R(2,:) = [0 1/2 3/4  3/16 zeros(n-4,1)'];
        R(3,:) = [0   0 1/4 11/16  5/12     5/72 zeros(n-6,1)'];
        R(4,:) = [0   0   0   1/8 25/48 625/1152 105/512 105/4096  zeros(n-8,1)'];
        R(5,:) = [0   0   0     0  1/16  137/384 493/897 355/1031  189/2000   21/2000 zeros(n-10,1)'];
        R(6,:) = [0   0   0     0     0     1/32 147/640 626/1303  876/2011 1746/8297    7/128    7/1152 zeros(n-12,1)']; % el elemento 1746/8297 es distinto en el final de la matriz
        R(7,:) = [0   0   0     0     0        0    1/64 363/2560 1219/3199 2656/5539  317/896 1277/8064      9/224    1/224 zeros(n-14,1)'];
        R(8,:) = [0   0   0     0     0        0       0    1/128  146/1719 1235/4671 801/1792   213/451   579/1792 251/1792  9/256 1/256 zeros(n-16,1)'];
        n1 = 9;
        for j = 9:nc-8
            R(j,[n1:n1+9]) = [1/256 9/256 9/64 21/64 63/128 63/128 21/64 9/64 9/256 1/256];
            n1 = n1 + 2;
        end
        R(nc-7,:) = [zeros(n-16,1)',1/256, 9/256, 251/1792, 579/1792, 213/451, 801/1792,1235/4671, 146/1719, 1/128, 0, 0, 0, 0, 0, 0, 0];
        R(nc-6,:) = [zeros(n-14,1)',1/224, 9/224, 1277/8064, 317/896, 2656/5539, 1219/3199, 363/2560, 1/64,0,0,0,0,0,0];
        R(nc-5,:) = [zeros(n-12,1)', 7/1152, 7/128, 1621/7703, 876/2011, 626/1303, 147/640, 1/32,0,0,0,0,0]; %%% el elemento 1621/7703 es distinto en la sexta fila de la matriz
        R(nc-4,:) = [zeros(n-10,1)',21/2000, 189/2000, 355/1031, 493/897, 137/384, 1/16,0,0,0,0];
        R(nc-3,:) = [zeros(n-8,1)', 105/4096,105/512,625/1152,25/48,1/8,0,0,0];
        R(nc-2,:) = [zeros(n-6,1)', 5/72,5/12,11/16,1/4,0,0];
        R(nc-1,:) = [zeros(n-4,1)',3/16,3/4,1/2,0];
        R(nc,:) = [zeros(n-2,1)',1/2,1];
%         R = R;
    end    
end   
return